<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Êó•Êú¨Âè≤‰∏¶„Å≥Êõø„Åà„Éû„Çπ„Çø„Éº</title>
    <style>
        :root {
            --primary-color: #34495e;
            --accent-color: #3498db;
            --correct-color: #00a652; 
            --wrong-color: #ff5252;
            --bg-color: #f0f2f5;
            --card-bg: #ffffff;
            --item-bg: #ecf0f1;
            --item-dragging: #d5dbdb;
            
            /* ÁµêÊûúÁîªÈù¢Áî®„ÅÆËâ≤ */
            --result-ok-bg: #e8f8f0;
            --result-ng-bg: #ffebee;
        }

        body {
            font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;
            background-color: var(--bg-color);
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            touch-action: manipulation; 
        }

        .container {
            background-color: var(--card-bg);
            width: 100%;
            max-width: 600px;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }

        h1 { color: var(--primary-color); margin-bottom: 0.5rem; font-size: 1.8rem; }
        h2 { font-size: 1rem; color: #7f8c8d; font-weight: normal; margin-bottom: 2rem; }

        .sortable-list {
            list-style: none;
            padding: 0;
            margin: 20px 0;
            text-align: left;
        }

        .sortable-item {
            background-color: var(--item-bg);
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            user-select: none;
            touch-action: none;
            position: relative;
        }

        .sortable-item:active { cursor: grabbing; }

        .sortable-item.dragging {
            opacity: 0.5;
            background-color: var(--item-dragging);
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        .sortable-item.selected {
            border: 2px solid var(--accent-color);
            background-color: #e3f2fd;
        }

        .item-rank {
            font-weight: bold;
            color: var(--accent-color);
            margin-right: 15px;
            font-size: 1.2rem;
            min-width: 30px;
        }

        .item-text {
            flex-grow: 1;
            font-size: 1rem;
            line-height: 1.4;
        }

        .handle {
            color: #bdc3c7;
            font-size: 1.5rem;
            cursor: grab;
            margin-left: 10px;
        }

        .btn {
            background-color: var(--accent-color);
            color: white;
            font-size: 1.1rem;
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            max-width: 300px;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { background-color: #95a5a6; cursor: not-allowed; }
        
        .btn-next { background-color: var(--primary-color); display: none; }

        .status-bar { display: flex; justify-content: space-between; color: #95a5a6; font-weight: bold; margin-bottom: 10px; }
        
        .feedback-area {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
            text-align: left;
        }
        .feedback-area.correct { background: #e8f8f0; border: 1px solid #00a652; }
        .feedback-area.wrong { background: #ffebee; border: 1px solid #ffcdd2; }
        
        .correct-order-display {
            font-size: 0.9rem;
            color: #555;
            margin-top: 10px;
        }
        .year-tag {
            display: inline-block;
            background: #607d8b;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-right: 5px;
        }

        .overlay-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .overlay-symbol {
            font-size: 10rem;
            opacity: 0;
            transform: scale(0.8);
            transition: opacity 0.3s, transform 0.3s;
            position: absolute;
            color: transparent !important;
            text-shadow: 0 0 0 var(--symbol-color) !important;
        }

        .overlay-symbol.active {
            opacity: 1;
            transform: scale(1.2);
            animation: pop-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        @keyframes pop-in {
            0% { opacity: 0; transform: scale(0.5); }
            60% { opacity: 1; transform: scale(1.3); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        /* --- ÁµêÊûú‰∏ÄË¶ßÁîªÈù¢„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥ --- */
        .result-detail-list {
            text-align: left;
            margin-top: 20px;
            border-top: 2px solid #eee;
        }
        .result-detail-item {
            padding: 15px; /* ‰ΩôÁôΩËøΩÂä† */
            border-bottom: 1px solid #eee;
            border-radius: 8px; /* Ëßí‰∏∏ */
            margin-bottom: 10px; /* „Ç¢„Ç§„ÉÜ„É†Èñì„ÅÆÈöôÈñì */
        }
        
        /* Ê≠£Ëß£ÊôÇ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .result-detail-item.ok {
            background-color: var(--result-ok-bg);
            border: 1px solid #c8e6c9;
        }
        
        /* ‰∏çÊ≠£Ëß£ÊôÇ„ÅÆ„Çπ„Çø„Ç§„É´ */
        .result-detail-item.ng {
            background-color: var(--result-ng-bg);
            border: 1px solid #ffcdd2;
        }

        .result-q-header {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }
        
        /* „Éû„Éº„ÇØ„ÅÆËâ≤Ë®≠ÂÆöÔºàÊñáÂ≠óËâ≤ÈÄèÊòé+ÂΩ±„ÅßËâ≤ÊåáÂÆöÔºâ */
        .result-mark {
            display: inline-block;
            margin-right: 8px;
            font-size: 1.4rem;
            color: transparent;
            text-shadow: 0 0 0 var(--mark-color);
        }

        .order-comparison {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            background: rgba(255,255,255,0.6); /* ËÉåÊôØ„ÇíÂ∞ë„ÅóÈÄèÈÅé */
            padding: 10px;
            border-radius: 8px;
        }
        .order-col {
            width: 48%;
        }
        .order-title {
            font-weight: bold;
            color: #7f8c8d;
            border-bottom: 1px solid #ccc;
            padding-bottom: 4px;
            margin-bottom: 6px;
            display: block;
        }
        .order-row {
            margin-bottom: 4px;
            line-height: 1.3;
            font-size: 0.85rem;
        }

        .hide { display: none !important; }

        @media (max-width: 480px) {
            .container { padding: 1.5rem; }
            .item-text { font-size: 0.9rem; }
            .order-comparison { flex-direction: column; }
            .order-col { width: 100%; margin-bottom: 10px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="overlay-container">
            <div id="overlay-correct" class="overlay-symbol" style="--symbol-color: var(--correct-color);">‚≠ï</div>
            <div id="overlay-wrong" class="overlay-symbol" style="--symbol-color: var(--wrong-color);">‚ùå</div>
        </div>

        <div id="start-screen">
            <h1>Êó•Êú¨Âè≤‰∏¶„Å≥Êõø„Åà„Éû„Çπ„Çø„Éº</h1>
            <h2>ÂÖ®10Âïè!<br>„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶‰∏¶„Å≥Êõø„ÅàÔºÅ</h2>
            <button class="btn" onclick="startGame()">„Çπ„Çø„Éº„Éà</button>
        </div>

        <div id="quiz-screen" class="hide">
            <div class="status-bar">
                <span id="q-num">Q 1/10</span>
                <span>„Çπ„Ç≥„Ç¢: <span id="score">0</span></span>
            </div>
            <h3 style="margin: 0 0 15px 0; color: #555;" id="period-label">ÊôÇ‰ª£</h3>
            <p style="font-size:0.9rem; color:#777; margin-bottom:15px;">‚Üì Âè§„ÅÑÈ†ÜÔºà‰∏ä„Åã„ÇâÔºâ„Å´‰∏¶„Åπ„Å¶„Åè„Å†„Åï„ÅÑ ‚Üì</p>

            <ul class="sortable-list" id="sortable-list">
                </ul>

            <button class="btn" id="check-btn" onclick="checkOrder()">ÂõûÁ≠î„Åô„Çã</button>
            
            <div class="feedback-area" id="feedback">
                <strong id="feedback-title"></strong>
                <div class="correct-order-display" id="correct-order-list"></div>
            </div>
            
            <button class="btn btn-next" id="next-btn" onclick="nextQuestion()">Ê¨°„ÅÆÂïèÈ°å„Å∏</button>
        </div>

        <div id="result-screen" class="hide">
            <h1>ÁµÇ‰∫ÜÔºÅ</h1>
            <p>„ÅÇ„Å™„Åü„ÅÆÊ≠£Ëß£Êï∞„ÅØ...</p>
            <h2 id="final-score" style="font-size: 3rem; color: var(--accent-color); margin: 10px 0;"></h2>
            <p id="final-msg"></p>
            
            <div id="result-detail-container" class="result-detail-list"></div>
            
            <button class="btn" onclick="startGame()">Êñ∞„Åó„ÅÑÂïèÈ°å„ÅßÈÅä„Å∂</button>
        </div>
    </div>

    <script>
        const fullHistoryData = [
  { "year": 57, "event": "Â•¥ÂõΩ„ÅÆÁéã„ÅåÂæåÊº¢„Å´‰Ωø„ÅÑ„ÇíÈÄÅ„Çã" },
  { "year": 239, "event": "ÂçëÂº•Âëº„ÅåÈ≠è„Å´‰Ωø„ÅÑ„ÇíÈÄÅ„Çã" },
  { "year": 552, "event": "‰ªèÊïô‰ºùÊù•" },
  { "year": 593, "event": "ËÅñÂæ≥Â§™Â≠ê„ÅåÊëÇÊîø„Å´„Å™„Çã" },
  { "year": 603, "event": "ÂÜ†‰ΩçÂçÅ‰∫åÈöé„ÅÆÂà∂ÂÆö" },
  { "year": 604, "event": "ÂçÅ‰∏ÉÊù°„ÅÆÊÜ≤Ê≥ï„ÅÆÂà∂ÂÆö" },
  { "year": 607, "event": "Á¨¨1ÂõûÈÅ£Èöã‰Ωø" },
  { "year": 630, "event": "Á¨¨1ÂõûÈÅ£Âîê‰Ωø" },
  { "year": 645, "event": "Â§ßÂåñ„ÅÆÊîπÊñ∞" },
  { "year": 663, "event": "ÁôΩÊùëÊ±ü„ÅÆÊà¶„ÅÑ" },
  { "year": 670, "event": "Â∫öÂçàÂπ¥Á±çÔºàÊúÄÂàù„ÅÆÂÖ®ÂõΩÁöÑ„Å™Êà∏Á±çÔºâ" },
  { "year": 672, "event": "Â£¨Áî≥„ÅÆ‰π±" },
  { "year": 694, "event": "Ëó§Âéü‰∫¨„Å´ÈÉΩ„ÇíÁßª„Åô" },
  { "year": 701, "event": "Â§ßÂÆùÂæã‰ª§„ÅÆÂà∂ÂÆö" },
  { "year": 708, "event": "ÂíåÂêåÈñãÁèé„ÅÆÁô∫Ë°å" },
  { "year": 710, "event": "Âπ≥Âüé‰∫¨„Å´ÈÉΩ„ÇíÁßª„Åô" },
  { "year": 712, "event": "„ÄéÂè§‰∫ãË®ò„ÄèÂÆåÊàê" },
  { "year": 720, "event": "„ÄéÊó•Êú¨Êõ∏Á¥Ä„ÄèÂÆåÊàê" },
  { "year": 723, "event": "‰∏â‰∏ñ‰∏ÄË∫´„ÅÆÊ≥ï" },
  { "year": 741, "event": "ÂõΩÂàÜÂØ∫„ÉªÂõΩÂàÜÂ∞ºÂØ∫Âª∫Á´ã„ÅÆË©î" },
  { "year": 743, "event": "Â¢æÁî∞Ê∞∏Âπ¥ÁßÅË≤°Ê≥ï" },
  { "year": 752, "event": "Êù±Â§ßÂØ∫„ÅÆÂ§ß‰ªèÈñãÁúº‰æõÈ§ä" },
  { "year": 784, "event": "Èï∑Â≤°‰∫¨„Å´ÈÉΩ„ÇíÁßª„Åô" },
  { "year": 794, "event": "Âπ≥ÂÆâ‰∫¨„Å´ÈÉΩ„ÇíÁßª„Åô" },
  { "year": 894, "event": "ÈÅ£Âîê‰Ωø„ÅÆÂªÉÊ≠¢" },
  { "year": 905, "event": "„ÄéÂè§‰ªäÂíåÊ≠åÈõÜ„Äè" },
  { "year": 935, "event": "Âπ≥Â∞ÜÈñÄ„ÅÆ‰π±" },
  { "year": 939, "event": "Ëó§ÂéüÁ¥îÂèã„ÅÆ‰π±" },
  { "year": 1016, "event": "Ëó§ÂéüÈÅìÈï∑„ÅåÊëÇÊîø„Å´„Å™„Çã" },
  { "year": 1051, "event": "Ââç‰πùÂπ¥„ÅÆÂΩπ" },
  { "year": 1083, "event": "Âæå‰∏âÂπ¥„ÅÆÂΩπ" },
  { "year": 1086, "event": "Èô¢Êîø„ÅÆÈñãÂßã" },
  { "year": 1156, "event": "‰øùÂÖÉ„ÅÆ‰π±" },
  { "year": 1159, "event": "Âπ≥Ê≤ª„ÅÆ‰π±" },
  { "year": 1167, "event": "Âπ≥Ê∏ÖÁõõ„ÅåÂ§™ÊîøÂ§ßËá£„Å´„Å™„Çã" },
  { "year": 1185, "event": "Â£á„ÉéÊµ¶„ÅÆÊà¶„ÅÑÔºàÂπ≥Ê∞èÊªÖ‰∫°Ôºâ" },
  { "year": 1192, "event": "Ê∫êÈ†ºÊúù„ÅåÂæÅÂ§∑Â§ßÂ∞ÜËªç„Å´„Å™„Çã" },
  { "year": 1221, "event": "Êâø‰πÖ„ÅÆ‰π±ÔºàÂÖ≠Ê≥¢ÁæÖÊé¢È°åË®≠ÁΩÆÔºâ" },
  { "year": 1232, "event": "Âæ°ÊàêÊïóÂºèÁõÆ„ÅÆÂà∂ÂÆö" },
  { "year": 1274, "event": "ÊñáÊ∞∏„ÅÆÂΩπ" },
  { "year": 1281, "event": "ÂºòÂÆâ„ÅÆÂΩπ" },
  { "year": 1297, "event": "Ê∞∏‰ªÅ„ÅÆÂæ≥Êîø‰ª§" },
  { "year": 1333, "event": "ÈéåÂÄâÂπïÂ∫úÊªÖ‰∫°" },
  { "year": 1334, "event": "Âª∫Ê≠¶„ÅÆÊñ∞Êîø" },
  { "year": 1338, "event": "Ë∂≥Âà©Â∞äÊ∞è„ÅåÂæÅÂ§∑Â§ßÂ∞ÜËªç„Å´„Å™„Çã" },
  { "year": 1392, "event": "ÂçóÂåóÊúù„ÅÆÂêà‰∏Ä" },
  { "year": 1404, "event": "ÂãòÂêàË≤øÊòìÔºàÊó•ÊòéË≤øÊòìÔºâ„ÅÆÈñãÂßã" },
  { "year": 1428, "event": "Ê≠£Èï∑„ÅÆÂúü‰∏ÄÊèÜ" },
  { "year": 1467, "event": "Âøú‰ªÅ„ÅÆ‰π±" },
  { "year": 1485, "event": "Â±±Âüé„ÅÆÂõΩ‰∏ÄÊèÜ" },
  { "year": 1488, "event": "Âä†Ë≥Ä„ÅÆ‰∏ÄÂêë‰∏ÄÊèÜ" },
  { "year": 1543, "event": "ÈâÑÁ†≤‰ºùÊù•" },
  { "year": 1549, "event": "„Ç≠„É™„Çπ„ÉàÊïô‰ºùÊù•" },
  { "year": 1560, "event": "Ê°∂Áã≠Èñì„ÅÆÊà¶„ÅÑ" },
  { "year": 1573, "event": "ÂÆ§Áî∫ÂπïÂ∫úÊªÖ‰∫°" },
  { "year": 1575, "event": "Èï∑ÁØ†„ÅÆÊà¶„ÅÑ" },
  { "year": 1582, "event": "Êú¨ËÉΩÂØ∫„ÅÆÂ§âÔºèÂ§™Èñ§Ê§úÂú∞ÈñãÂßã" },
  { "year": 1587, "event": "„Éê„ÉÜ„É¨„É≥ËøΩÊîæ‰ª§" },
  { "year": 1588, "event": "ÂàÄÁã©‰ª§" },
  { "year": 1590, "event": "Ë±äËá£ÁßÄÂêâ„ÅÆÂÖ®ÂõΩÁµ±‰∏Ä" },
  { "year": 1592, "event": "ÊñáÁ¶Ñ„ÅÆÂΩπ" },
  { "year": 1597, "event": "ÊÖ∂Èï∑„ÅÆÂΩπ" },
  { "year": 1600, "event": "Èñ¢„É∂Âéü„ÅÆÊà¶„ÅÑÔºè„É™„Éº„Éï„ÉáÂè∑ÊºÇÁùÄ" },
  { "year": 1603, "event": "Âæ≥Â∑ùÂÆ∂Â∫∑„ÅåÂæÅÂ§∑Â§ßÂ∞ÜËªç„Å´„Å™„Çã" },
  { "year": 1615, "event": "Â§ßÂùÇÂ§è„ÅÆÈô£ÔºèÊ≠¶ÂÆ∂Ë´∏Ê≥ïÂ∫¶" },
  { "year": 1635, "event": "ÂèÇÂã§‰∫§‰ª£„ÅÆÂà∂Â∫¶Âåñ" },
  { "year": 1637, "event": "Â≥∂Âéü„ÉªÂ§©Ëçâ‰∏ÄÊèÜ" },
  { "year": 1639, "event": "„Éù„É´„Éà„Ç¨„É´Ëàπ„ÅÆÊù•Ëà™Á¶ÅÊ≠¢ÔºàÈéñÂõΩÔºâ" },
  { "year": 1641, "event": "„Ç™„É©„É≥„ÉÄÂïÜÈ§®„ÇíÈï∑Â¥é„ÅÆÂá∫Â≥∂„Å´Áßª„Åô" },
  { "year": 1657, "event": "ÊòéÊö¶„ÅÆÂ§ßÁÅ´" },
  { "year": 1669, "event": "„Ç∑„É£„ÇØ„Ç∑„É£„Ç§„É≥„ÅÆÊà¶„ÅÑ" },
  { "year": 1685, "event": "ÁîüÈ°ûÊÜê„Åø„ÅÆ‰ª§" },
  { "year": 1709, "event": "Êñ∞‰∫ïÁôΩÁü≥„ÅÆÊîøÊ≤ª" },
  { "year": 1716, "event": "‰∫´‰øù„ÅÆÊîπÈù©" },
  { "year": 1742, "event": "ÂÖ¨‰∫ãÊñπÂæ°ÂÆöÊõ∏„ÅÆÂà∂ÂÆö" },
  { "year": 1772, "event": "Áî∞Ê≤ºÊÑèÊ¨°„ÅÆÊîøÊ≤ª" },
  { "year": 1774, "event": "„ÄéËß£‰ΩìÊñ∞Êõ∏„ÄèÂá∫Áâà" },
  { "year": 1776, "event": "„Ç¢„É°„É™„Ç´Áã¨Á´ãÂÆ£Ë®Ä" },
  { "year": 1782, "event": "Â§©Êòé„ÅÆÂ§ßÈ£¢È•â" },
  { "year": 1787, "event": "ÂØõÊîø„ÅÆÊîπÈù©" },
  { "year": 1789, "event": "„Éï„É©„É≥„ÇπÈù©ÂëΩ" },
  { "year": 1792, "event": "„É©„ÇØ„Çπ„Éû„É≥Êù•Ëà™" },
  { "year": 1804, "event": "„É¨„Ç∂„Éé„ÉïÊù•Ëà™" },
  { "year": 1808, "event": "„Éï„Çß„Éº„Éà„É≥Âè∑‰∫ã‰ª∂" },
  { "year": 1825, "event": "Áï∞ÂõΩËàπÊâìÊâï‰ª§" },
  { "year": 1833, "event": "Â§©‰øù„ÅÆÂ§ßÈ£¢È•â" },
  { "year": 1837, "event": "Â§ßÂ°©Âπ≥ÂÖ´ÈÉé„ÅÆ‰π±" },
  { "year": 1839, "event": "ËõÆÁ§æ„ÅÆÁçÑ" },
  { "year": 1840, "event": "„Ç¢„Éò„É≥Êà¶‰∫â" },
  { "year": 1841, "event": "Â§©‰øù„ÅÆÊîπÈù©" },
  { "year": 1842, "event": "Ëñ™Ê∞¥Áµ¶‰∏é‰ª§" },
  { "year": 1853, "event": "„Éö„É™„ÉºÊù•Ëà™" },
  { "year": 1854, "event": "Êó•Á±≥ÂíåË¶™Êù°Á¥Ñ" },
  { "year": 1858, "event": "Êó•Á±≥‰øÆÂ•ΩÈÄöÂïÜÊù°Á¥Ñ" },
  { "year": 1860, "event": "Ê°úÁî∞ÈñÄÂ§ñ„ÅÆÂ§â" },
  { "year": 1862, "event": "ÁîüÈ∫¶‰∫ã‰ª∂" },
  { "year": 1863, "event": "Ëñ©Ëã±Êà¶‰∫â" },
  { "year": 1866, "event": "Ëñ©Èï∑ÂêåÁõü" },
  { "year": 1867, "event": "Â§ßÊîøÂ•âÈÇÑ" },
  { "year": 1868, "event": "ÊàäËæ∞Êà¶‰∫âÔºèÊòéÊ≤ªÂÖÉÂπ¥" },
  { "year": 1869, "event": "ÁâàÁ±çÂ•âÈÇÑ" },
  { "year": 1871, "event": "ÂªÉËó©ÁΩÆÁúå" },
  { "year": 1872, "event": "Â≠¶Âà∂ÔºèÈâÑÈÅìÈñãÈÄö" },
  { "year": 1873, "event": "Âæ¥ÂÖµ‰ª§ÔºèÂú∞ÁßüÊîπÊ≠£" },
  { "year": 1874, "event": "Ê∞ëÊí∞Ë≠∞Èô¢Ë®≠Á´ã„ÅÆÂª∫ÁôΩÊõ∏" },
  { "year": 1877, "event": "Ë•øÂçóÊà¶‰∫â" },
  { "year": 1881, "event": "ÂõΩ‰ºöÈñãË®≠„ÅÆÂãÖË´≠" },
  { "year": 1885, "event": "ÂÜÖÈñ£Âà∂Â∫¶„ÅÆÂâµË®≠" },
  { "year": 1886, "event": "„Éé„É´„Éû„É≥„Éà„É≥Âè∑‰∫ã‰ª∂" },
  { "year": 1889, "event": "Â§ßÊó•Êú¨Â∏ùÂõΩÊÜ≤Ê≥ïÁô∫Â∏É" },
  { "year": 1890, "event": "Á¨¨1ÂõûÂ∏ùÂõΩË≠∞‰ºöÔºèÊïôËÇ≤ÂãÖË™û" },
  { "year": 1894, "event": "È†ò‰∫ãË£ÅÂà§Ê®©„ÅÆÊí§ÂªÉÔºèÊó•Ê∏ÖÊà¶‰∫â" },
  { "year": 1895, "event": "‰∏ãÈñ¢Êù°Á¥ÑÔºè‰∏âÂõΩÂπ≤Ê∏â" },
  { "year": 1901, "event": "ÂÖ´Âπ°Ë£ΩÈâÑÊâÄÊìçÊ•≠ÈñãÂßã" },
  { "year": 1902, "event": "Êó•Ëã±ÂêåÁõü" },
  { "year": 1904, "event": "Êó•Èú≤Êà¶‰∫â" },
  { "year": 1905, "event": "„Éù„Éº„ÉÑ„Éû„ÇπÊù°Á¥ÑÔºèÊó•ÊØîË∞∑ÁÑºÊâì‰∫ã‰ª∂" },
  { "year": 1910, "event": "ÈüìÂõΩ‰ΩµÂêà" },
  { "year": 1911, "event": "Èñ¢Á®éËá™‰∏ªÊ®©„ÅÆÂõûÂæ©" },
  { "year": 1912, "event": "Â§ßÊ≠£ÂÖÉÂπ¥" },
  { "year": 1914, "event": "Á¨¨‰∏ÄÊ¨°‰∏ñÁïåÂ§ßÊà¶" },
  { "year": 1915, "event": "‰∫åÂçÅ‰∏Ä„ÅãÊù°„ÅÆË¶ÅÊ±Ç" },
  { "year": 1917, "event": "„É≠„Ç∑„Ç¢Èù©ÂëΩ" },
  { "year": 1918, "event": "Á±≥È®íÂãï" },
  { "year": 1919, "event": "„Éô„É´„Çµ„Ç§„É¶Êù°Á¥Ñ" },
  { "year": 1920, "event": "ÂõΩÈöõÈÄ£ÁõüÁô∫Ë∂≥" },
  { "year": 1922, "event": "ÂÖ®ÂõΩÊ∞¥Âπ≥Á§æÁµêÊàê" },
  { "year": 1923, "event": "Èñ¢Êù±Â§ßÈúáÁÅΩ" },
  { "year": 1925, "event": "ÊôÆÈÄöÈÅ∏ÊåôÊ≥ïÔºèÊ≤ªÂÆâÁ∂≠ÊåÅÊ≥ï" },
  { "year": 1926, "event": "Êò≠ÂíåÂÖÉÂπ¥" },
  { "year": 1929, "event": "‰∏ñÁïåÊÅêÊÖå" },
  { "year": 1931, "event": "Ê∫ÄÂ∑û‰∫ãÂ§â" },
  { "year": 1932, "event": "‰∫î„Éª‰∏Ä‰∫î‰∫ã‰ª∂ÔºèÊ∫ÄÂ∑ûÂõΩÂª∫ÂõΩ" },
  { "year": 1933, "event": "ÂõΩÈöõÈÄ£ÁõüËÑ±ÈÄÄ" },
  { "year": 1936, "event": "‰∫å„Éª‰∫åÂÖ≠‰∫ã‰ª∂" },
  { "year": 1937, "event": "Êó•‰∏≠Êà¶‰∫â" },
  { "year": 1938, "event": "ÂõΩÂÆ∂Á∑èÂãïÂì°Ê≥ï" },
  { "year": 1939, "event": "Á¨¨‰∫åÊ¨°‰∏ñÁïåÂ§ßÊà¶ÈñãÂßã" },
  { "year": 1940, "event": "Êó•Áã¨‰ºä‰∏âÂõΩÂêåÁõü" },
  { "year": 1941, "event": "Â§™Âπ≥Ê¥ãÊà¶‰∫âÈñãÂßã" },
  { "year": 1945, "event": "ÁµÇÊà¶ÔºèÂõΩÈöõÈÄ£ÂêàÁô∫Ë∂≥" },
  { "year": 1946, "event": "Êó•Êú¨ÂõΩÊÜ≤Ê≥ïÂÖ¨Â∏ÉÔºèËæ≤Âú∞ÊîπÈù©" },
  { "year": 1947, "event": "Êó•Êú¨ÂõΩÊÜ≤Ê≥ïÊñΩË°åÔºèÁã¨Âç†Á¶ÅÊ≠¢Ê≥ï" },
  { "year": 1950, "event": "ÊúùÈÆÆÊà¶‰∫â" },
  { "year": 1951, "event": "„Çµ„É≥„Éï„É©„É≥„Ç∑„Çπ„Ç≥Âπ≥ÂíåÊù°Á¥Ñ" },
  { "year": 1953, "event": "„ÉÜ„É¨„ÉìÊîæÈÄÅÈñãÂßã" },
  { "year": 1954, "event": "Ëá™Ë°õÈöäÁô∫Ë∂≥" },
  { "year": 1956, "event": "Êó•„ÇΩÂÖ±ÂêåÂÆ£Ë®ÄÔºèÂõΩÈöõÈÄ£ÂêàÂä†Áõü" },
  { "year": 1960, "event": "Êó•Á±≥ÂÆâ‰øùÊù°Á¥ÑÊîπÂÆö" },
  { "year": 1964, "event": "Êù±‰∫¨„Ç™„É™„É≥„Éî„ÉÉ„ÇØ" },
  { "year": 1965, "event": "Êó•ÈüìÂü∫Êú¨Êù°Á¥Ñ" },
  { "year": 1972, "event": "Ê≤ñÁ∏ÑËøîÈÇÑÔºèÊó•‰∏≠ÂÖ±ÂêåÂ£∞Êòé" },
  { "year": 1973, "event": "Áü≥Ê≤πÂç±Ê©üÔºà„Ç™„Ç§„É´„Ç∑„Éß„ÉÉ„ÇØÔºâ" },
  { "year": 1978, "event": "Êó•‰∏≠Âπ≥ÂíåÂèãÂ•ΩÊù°Á¥Ñ" },
  { "year": 1989, "event": "Âπ≥ÊàêÂÖÉÂπ¥ÔºèÊ∂àË≤ªÁ®éÂ∞éÂÖ•" },
  { "year": 1991, "event": "„Éê„Éñ„É´Â¥©Â£ä" },
  { "year": 1995, "event": "Èò™Á•û„ÉªÊ∑°Ë∑ØÂ§ßÈúáÁÅΩ" },
  { "year": 1997, "event": "‰∫¨ÈÉΩË≠∞ÂÆöÊõ∏" },
  { "year": 2001, "event": "„Ç¢„É°„É™„Ç´ÂêåÊôÇÂ§öÁô∫„ÉÜ„É≠‰∫ã‰ª∂" },
  { "year": 2008, "event": "„É™„Éº„Éû„É≥„Éª„Ç∑„Éß„ÉÉ„ÇØ" },
  { "year": 2011, "event": "Êù±Êó•Êú¨Â§ßÈúáÁÅΩ" },
  { "year": 2019, "event": "‰ª§ÂíåÂÖÉÂπ¥" }
];

        const periodDefinitions = [
            { name: "È£õÈ≥•„ÉªÂ•àËâØÊôÇ‰ª£", start: 0, end: 793 },
            { name: "Âπ≥ÂÆâÊôÇ‰ª£", start: 794, end: 1184 },
            { name: "ÈéåÂÄâÊôÇ‰ª£", start: 1185, end: 1332 },
            { name: "ÂÆ§Áî∫„ÉªÂÆâÂúüÊ°ÉÂ±±ÊôÇ‰ª£", start: 1333, end: 1602 },
            { name: "Ê±üÊà∏ÊôÇ‰ª£ÔºàÂâçÊúüÔºâ", start: 1603, end: 1750 },
            { name: "Ê±üÊà∏ÊôÇ‰ª£ÔºàÂæåÊúüÔºâÔΩûÂπïÊú´", start: 1751, end: 1867 },
            { name: "ÊòéÊ≤ªÊôÇ‰ª£", start: 1868, end: 1911 },
            { name: "Â§ßÊ≠£„ÉªÊò≠ÂíåÔºàÊà¶ÂâçÔºâ", start: 1912, end: 1944 },
            { name: "Êò≠ÂíåÔºàÊà¶ÂæåÔºâ", start: 1945, end: 1988 },
            { name: "Âπ≥Êàê„Éª‰ª§Âíå", start: 1989, end: 2025 }
        ];

        let currentQuizData = [];
        let currentQIndex = 0;
        let score = 0;
        let currentItems = [];
        let userAnswersLog = [];

        function startGame() {
            generateQuiz();
            document.getElementById('start-screen').classList.add('hide');
            document.getElementById('result-screen').classList.add('hide');
            document.getElementById('quiz-screen').classList.remove('hide');
            score = 0;
            currentQIndex = 0;
            userAnswersLog = [];
            loadQuestion();
        }

        function generateQuiz() {
            currentQuizData = [];
            
            periodDefinitions.forEach(period => {
                const candidates = fullHistoryData.filter(e => e.year >= period.start && e.year <= period.end);
                
                const byYear = {};
                candidates.forEach(c => {
                    if(!byYear[c.year]) byYear[c.year] = [];
                    byYear[c.year].push(c);
                });
                
                const uniqueYearCandidates = Object.keys(byYear).map(y => {
                    const list = byYear[y];
                    return list[Math.floor(Math.random() * list.length)];
                });

                if (uniqueYearCandidates.length >= 4) {
                    const selected = shuffle(uniqueYearCandidates).slice(0, 4);
                    selected.sort((a, b) => a.year - b.year);
                    currentQuizData.push({
                        period: period.name,
                        events: selected.map(e => ({ year: e.year, text: e.event }))
                    });
                } else {
                    const selected = uniqueYearCandidates.sort((a, b) => a.year - b.year);
                    currentQuizData.push({
                        period: period.name,
                        events: selected.map(e => ({ year: e.year, text: e.event }))
                    });
                }
            });
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function loadQuestion() {
            const q = currentQuizData[currentQIndex];
            
            document.getElementById('q-num').innerText = `Q ${currentQIndex + 1} / 10`;
            document.getElementById('score').innerText = score;
            document.getElementById('period-label').innerText = q.period;
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('feedback').classList.remove('correct', 'wrong');
            document.getElementById('check-btn').style.display = 'inline-block';
            document.getElementById('check-btn').disabled = false;
            document.getElementById('next-btn').style.display = 'none';

            currentItems = shuffle([...q.events]); 
            renderList();
        }

        function renderList() {
            const list = document.getElementById('sortable-list');
            list.innerHTML = '';

            currentItems.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'sortable-item';
                li.setAttribute('draggable', 'true');
                li.dataset.index = index;

                li.innerHTML = `
                    <span class="item-rank">${index + 1}</span>
                    <span class="item-text">${item.text}</span>
                    <span class="handle">‚ò∞</span>
                `;

                addDragEvents(li);
                addTouchEvents(li);
                list.appendChild(li);
            });
        }

        let dragStartIndex;

        function addDragEvents(item) {
            item.addEventListener('dragstart', () => {
                dragStartIndex = +item.dataset.index;
                item.classList.add('dragging');
            });
            item.addEventListener('dragover', (e) => e.preventDefault());
            item.addEventListener('drop', () => {
                const dragEndIndex = +item.dataset.index;
                swapItems(dragStartIndex, dragEndIndex);
                item.classList.remove('dragging');
            });
            item.addEventListener('dragenter', () => item.style.backgroundColor = '#e3f2fd');
            item.addEventListener('dragleave', () => item.style.backgroundColor = '');
            item.addEventListener('dragend', () => {
                item.classList.remove('dragging');
                document.querySelectorAll('.sortable-item').forEach(el => el.style.backgroundColor = '');
            });
        }

        let selectedIndex = null;

        function addTouchEvents(item) {
            item.addEventListener('click', () => {
                if(document.getElementById('check-btn').disabled) return;
                const index = +item.dataset.index;
                if (selectedIndex === null) {
                    selectedIndex = index;
                    item.classList.add('selected');
                } else if (selectedIndex === index) {
                    selectedIndex = null;
                    item.classList.remove('selected');
                } else {
                    swapItems(selectedIndex, index);
                    selectedIndex = null;
                }
            });
        }

        function swapItems(fromIndex, toIndex) {
            const itemOne = currentItems[fromIndex];
            const itemTwo = currentItems[toIndex];
            currentItems[fromIndex] = itemTwo;
            currentItems[toIndex] = itemOne;
            renderList();
        }

        function checkOrder() {
            const feedback = document.getElementById('feedback');
            const feedbackTitle = document.getElementById('feedback-title');
            const correctOrderList = document.getElementById('correct-order-list');
            const checkBtn = document.getElementById('check-btn');
            
            const overlayCorrect = document.getElementById('overlay-correct');
            const overlayWrong = document.getElementById('overlay-wrong');

            checkBtn.disabled = true;

            let isCorrect = true;
            for (let i = 0; i < currentItems.length - 1; i++) {
                if (currentItems[i].year > currentItems[i+1].year) {
                    isCorrect = false;
                    break;
                }
            }

            const correctItems = currentQuizData[currentQIndex].events;
            
            userAnswersLog.push({
                questionTitle: `Q${currentQIndex + 1} (${currentQuizData[currentQIndex].period})`,
                isCorrect: isCorrect,
                userOrder: [...currentItems], 
                correctOrder: [...correctItems]
            });

            feedback.style.display = 'block';

            if (isCorrect) {
                score++;
                document.getElementById('score').innerText = score;
                feedbackTitle.innerText = "Â§ßÊ≠£Ëß£ÔºÅ";
                feedbackTitle.style.color = "var(--correct-color)";
                feedback.className = "feedback-area correct";
                
                overlayCorrect.classList.add('active');
                setTimeout(() => overlayCorrect.classList.remove('active'), 600);
                
                correctOrderList.innerText = "";
            } else {
                feedbackTitle.innerText = "ÊÆãÂøµ...";
                feedbackTitle.style.color = "var(--wrong-color)";
                feedback.className = "feedback-area wrong";
                
                overlayWrong.classList.add('active');
                setTimeout(() => overlayWrong.classList.remove('active'), 600);
                
                let html = "<strong>Ê≠£„Åó„ÅÑÈ†ÜÁï™:</strong><br>";
                correctItems.forEach((item, idx) => {
                    html += `<div style="margin-top:4px;">${idx+1}. <span class="year-tag">${item.year}Âπ¥</span> ${item.text}</div>`;
                });
                correctOrderList.innerHTML = html;
            }

            document.getElementById('next-btn').style.display = 'inline-block';
        }

        function nextQuestion() {
            currentQIndex++;
            if (currentQIndex < 10) {
                loadQuestion();
            } else {
                showResult();
            }
        }

        function showResult() {
            document.getElementById('quiz-screen').classList.add('hide');
            document.getElementById('result-screen').classList.remove('hide');
            document.getElementById('final-score').innerText = `${score} / 10`;
            
            const msg = document.getElementById('final-msg');
            if(score === 10) msg.innerText = "Ê≠¥Âè≤„ÅÆÊµÅ„Çå„ÇíÂÆåÁíß„Å´ÁêÜËß£„Åó„Å¶„ÅÑ„Åæ„ÅôÔºÅÁ¥†Êô¥„Çâ„Åó„ÅÑÔºÅüèÜ";
            else if(score >= 7) msg.innerText = "ÊÉú„Åó„ÅÑÔºÅ„ÅÇ„Å®Â∞ë„Åó„ÅßÊ∫ÄÁÇπ„Åß„Åô„ÄÇüëç";
            else msg.innerText = "ÊôÇ‰ª£„ÅÆÊµÅ„Çå„ÇíÂæ©Áøí„Åó„Å¶„ÄÅÂÜçÊåëÊà¶„Åó„Åæ„Åó„Çá„ÅÜÔºÅüìö";

            const container = document.getElementById('result-detail-container');
            container.innerHTML = "";

            userAnswersLog.forEach((log) => {
                const item = document.createElement('div');
                item.className = `result-detail-item ${log.isCorrect ? 'ok' : 'ng'}`;
                
                const markClass = log.isCorrect ? 'ok' : 'ng';
                const markSymbol = log.isCorrect ? '‚≠ï' : '‚ùå';
                // „Éû„Éº„ÇØ„ÅÆËâ≤Ë®≠ÂÆö
                const markColorVar = log.isCorrect ? 'var(--correct-color)' : 'var(--wrong-color)';

                let html = `
                    <div class="result-q-header">
                        <span class="result-mark" style="--mark-color: ${markColorVar}">${markSymbol}</span> ${log.questionTitle}
                    </div>
                    <div class="order-comparison">
                        <div class="order-col">
                            <span class="order-title">„ÅÇ„Å™„Åü„ÅÆÂõûÁ≠î</span>
                            ${log.userOrder.map((e, i) => `<div class="order-row">${i+1}. ${e.text}</div>`).join('')}
                        </div>
                        <div class="order-col">
                            <span class="order-title">Ê≠£Ëß£</span>
                            ${log.correctOrder.map((e, i) => `<div class="order-row">${i+1}. ${e.text}</div>`).join('')}
                        </div>
                    </div>
                `;
                item.innerHTML = html;
                container.appendChild(item);
            });
        }
    </script>
</body>
</html>